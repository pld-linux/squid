Index: squid/src/repl/heap/store_repl_heap.c
diff -c squid/src/repl/heap/store_repl_heap.c:1.8.2.1 squid/src/repl/heap/store_repl_heap.c:1.8.2.2
*** squid/src/repl/heap/store_repl_heap.c:1.8.2.1	Sun Jul 21 18:07:17 2002
--- squid/src/repl/heap/store_repl_heap.c	Thu Aug  5 14:23:01 2004
***************
*** 191,196 ****
--- 191,197 ----
      age = heap_peepminkey(heap->heap);
      entry = heap_extractmin(heap->heap);
      if (storeEntryLocked(entry)) {
+ 	storeLockObject(entry);
  	linklistPush(&heap_walker->locked_entries, entry);
  	goto try_again;
      }
***************
*** 220,225 ****
--- 221,227 ----
      while ((entry = linklistShift(&heap_walker->locked_entries))) {
  	heap_node *node = heap_insert(heap->heap, entry);
  	SET_POLICY_NODE(entry, node);
+ 	storeUnlockObject(entry);
      }
      safe_free(walker->_data);
      cbdataFree(walker);
