Index: squid/configure.in
diff -c squid/configure.in:1.251.2.52 squid/configure.in:1.251.2.53
*** squid/configure.in:1.251.2.52	Tue Mar  2 11:58:27 2004
--- squid/configure.in	Sat Mar  6 08:14:05 2004
***************
*** 32,37 ****
--- 32,40 ----
  REGEXLIB=''	# -lregex
  LIBREGEX=''	# libregex.a
  
+ dnl Check for pkg-config
+ AC_PATH_PROG(PKGCONFIG, pkg-config, /usr/bin/false)
+ 
  dnl find out the exe extension for this platform. If it's not empty, use it for CGI's as well.
  AC_EXEEXT
  AC_OBJEXT
***************
*** 594,604 ****
    if test -z "$SSLLIB"; then
      SSLLIB="-lcrypto" # for MD5 routines
    fi
!   dnl This is a workaround for RedHat 9 brain damage..
!   if test -d /usr/kerberos/include && test -z "$SSLLIBDIR" && test -f /usr/include/openssl/kssl.h; then
!     echo "OpenSSL depends on Kerberos"
!     SSLLIBDIR="/usr/kerberos/lib"
!     CPPFLAGS="$CPPFLAGS -I/usr/kerberos/include"
    fi
  fi
  if test -n "$SSLLIBDIR"; then
--- 597,605 ----
    if test -z "$SSLLIB"; then
      SSLLIB="-lcrypto" # for MD5 routines
    fi
!   if $PKGCONFIG --exists openssl; then
!     SSLLIB="`$PKGCONFIG --libs openssl`"
!     CPPFLAGS="`$PKGCONFIG --cflags openssl` $CPPFLAGS"
    fi
  fi
  if test -n "$SSLLIBDIR"; then
Index: squid/configure
diff -c squid/configure:1.248.2.54 squid/configure:1.248.2.55
*** squid/configure:1.248.2.54	Tue Mar  2 18:11:26 2004
--- squid/configure	Sat Mar  6 18:11:26 2004
***************
*** 1515,1520 ****
  REGEXLIB=''	# -lregex
  LIBREGEX=''	# libregex.a
  
  echo $ac_n "checking for Cygwin environment""... $ac_c" 1>&6
  echo "configure:1515: checking for Cygwin environment" >&5
  if eval "test \"`echo '$''{'ac_cv_cygwin'+set}'`\" = set"; then
--- 1515,1557 ----
  REGEXLIB=''	# -lregex
  LIBREGEX=''	# libregex.a
  
+ # Extract the first word of "pkg-config", so it can be a program name with args.
+ set dummy pkg-config; ac_word=$2
+ echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+ echo "configure:1517: checking for $ac_word" >&5
+ if eval "test \"`echo '$''{'ac_cv_path_PKGCONFIG'+set}'`\" = set"; then
+   echo $ac_n "(cached) $ac_c" 1>&6
+ else
+   case "$PKGCONFIG" in
+   /*)
+   ac_cv_path_PKGCONFIG="$PKGCONFIG" # Let the user override the test with a path.
+   ;;
+   ?:/*)			 
+   ac_cv_path_PKGCONFIG="$PKGCONFIG" # Let the user override the test with a dos path.
+   ;;
+   *)
+   IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+   ac_dummy="$PATH"
+   for ac_dir in $ac_dummy; do 
+     test -z "$ac_dir" && ac_dir=.
+     if test -f $ac_dir/$ac_word; then
+       ac_cv_path_PKGCONFIG="$ac_dir/$ac_word"
+       break
+     fi
+   done
+   IFS="$ac_save_ifs"
+   test -z "$ac_cv_path_PKGCONFIG" && ac_cv_path_PKGCONFIG="/usr/bin/false"
+   ;;
+ esac
+ fi
+ PKGCONFIG="$ac_cv_path_PKGCONFIG"
+ if test -n "$PKGCONFIG"; then
+   echo "$ac_t""$PKGCONFIG" 1>&6
+ else
+   echo "$ac_t""no" 1>&6
+ fi
+ 
+ 
  echo $ac_n "checking for Cygwin environment""... $ac_c" 1>&6
  echo "configure:1515: checking for Cygwin environment" >&5
  if eval "test \"`echo '$''{'ac_cv_cygwin'+set}'`\" = set"; then
***************
*** 2365,2374 ****
    if test -z "$SSLLIB"; then
      SSLLIB="-lcrypto" # for MD5 routines
    fi
!     if test -d /usr/kerberos/include && test -z "$SSLLIBDIR" && test -f /usr/include/openssl/kssl.h; then
!     echo "OpenSSL depends on Kerberos"
!     SSLLIBDIR="/usr/kerberos/lib"
!     CPPFLAGS="$CPPFLAGS -I/usr/kerberos/include"
    fi
  fi
  if test -n "$SSLLIBDIR"; then
--- 2402,2410 ----
    if test -z "$SSLLIB"; then
      SSLLIB="-lcrypto" # for MD5 routines
    fi
!   if $PKGCONFIG --exists openssl; then
!     SSLLIB="`$PKGCONFIG --libs openssl`"
!     CPPFLAGS="`$PKGCONFIG --cflags openssl` $CPPFLAGS"
    fi
  fi
  if test -n "$SSLLIBDIR"; then
